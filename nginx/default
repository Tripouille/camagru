  
upstream app_server {
    server unix:/.unicorn.sock fail_timeout=0;
}

server {
	listen 80 default_server;
	listen [::]:80 default_server;
	server_name localhost;
	return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;
	server_name localhost;

	ssl on;
	ssl_certificate /etc/ssl/certs/localhost.crt;
	ssl_certificate_key /etc/ssl/private/localhost.key;
	ssl_protocols TLSv1.2;
	ssl_ciphers HIGH:!aNULL:!MD5;
	root /usr/share/webapps/;

	index index index.php index.html index.htm index.nginx-debian.html;

	location / {
		autoindex on;
		try_files $uri $uri/ =404;
		#proxy_pass https://localhost;
	}

	location ~ \.php$ {
		fastcgi_pass      127.0.0.1:9000;
		fastcgi_index     index.php;
		include           fastcgi.conf;
	}

	location @app {
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

		proxy_set_header Host $http_host;

		proxy_redirect off;

		# proxy_pass PI-LINK-0eacd313867281a74afda970453019e5d2a32061;
		proxy_pass http://app_server;
    }
}